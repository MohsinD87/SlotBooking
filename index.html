<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Slot Booking</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f3f5f7;
      padding: 20px;
      text-align: center;
    }

    h2 {
      color: #333;
    }

    #calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      margin-top: 20px;
    }

    .day {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 5px #ccc;
      cursor: pointer;
    }

    .day:hover {
      background: #e7f1ff;
    }

    #slots {
      margin-top: 30px;
    }

    .slot {
      padding: 12px;
      margin: 8px auto;
      width: 220px;
      border-radius: 6px;
      background: #fff;
      box-shadow: 0 0 5px #ccc;
      cursor: pointer;
    }

    .slot.booked {
      background: #ffdddd;
      border-left: 5px solid #c62828;
      cursor: not-allowed;
    }

    .slot.available {
      background: #ddffdd;
      border-left: 5px solid #2e7d32;
    }

    .slot.available:hover {
      background: #b9ffb9;
    }
  </style>
</head>
<body>

  <h2>Select a Date</h2>
  <div id="calendar"></div>

  <h2>Available Slots</h2>
  <div id="slots"></div>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbyhqEfHf_Qswsyw3tY3fAaPTmXJCp_PP9HOD83CNdLMPfDZ312Z3jubLwx3dHk35OEH/exec";  // <-- replace this
  const APP_SECRET = "msdamdsmdhmdamd2012"; // <-- replace this

  // ----------------------------------------------------------
  // 1. Build Calendar UI
  // ----------------------------------------------------------
  const calendarDiv = document.getElementById("calendar");
  const slotsDiv = document.getElementById("slots");

  function buildCalendar() {
    const today = new Date();
    const dates = [];

    for (let i = 0; i < 7; i++) {
      const d = new Date();
      d.setDate(today.getDate() + i);
      dates.push(d);
    }

    calendarDiv.innerHTML = "";

    dates.forEach(date => {
      const dayDiv = document.createElement("div");
      dayDiv.className = "day";
      dayDiv.innerHTML = `
        <b>${date.toDateString()}</b>
      `;
      
      dayDiv.onclick = () => loadSlots(date.toISOString().split("T")[0]);
      
      calendarDiv.appendChild(dayDiv);
    });
  }

  // ----------------------------------------------------------
  // 2. Load Slots From Backend
  // ----------------------------------------------------------
  function loadSlots(dateStr) {
    slotsDiv.innerHTML = "<p>Loading...</p>";

    fetch(`${API_URL}?date=${dateStr}&secret=${APP_SECRET}`)
      .then(r => r.json())
      .then(data => {
        if (data.error) {
          slotsDiv.innerHTML = "<p style='color:red'>Error loading slots</p>";
          return;
        }

        displaySlots(data, dateStr);
      })
      .catch(err => {
        slotsDiv.innerHTML = "<p style='color:red'>Network error</p>";
      });
  }

  // ----------------------------------------------------------
  // 3. Display Slots
  // ----------------------------------------------------------
  function displaySlots(slots, dateStr) {
    slotsDiv.innerHTML = "";

    slots.forEach(slot => {
      const div = document.createElement("div");
      div.className = "slot " + (slot.booked ? "booked" : "available");
      div.textContent = slot.time + (slot.booked ? " — Booked" : " — Available");

      if (!slot.booked) {
        div.onclick = () => bookSlot(dateStr, slot.time);
      }

      slotsDiv.appendChild(div);
    });
  }

  // ----------------------------------------------------------
  // 4. Book a Slot
  // ----------------------------------------------------------
  function bookSlot(date, time) {
    const name = prompt("Enter your name:");

    if (!name) return;

    fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({
        secret: APP_SECRET,
        date: date,
        time: time,
        name: name
      })
    })
    .then(r => r.json())
    .then(data => {
      if (data.success) {
        alert("Slot booked successfully!");
        loadSlots(date);
      } else {
        alert("Error: " + data.error);
      }
    });
  }

  // Start calendar
  buildCalendar();
</script>

</body>
</html>
